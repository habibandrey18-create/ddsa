# üìä –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö

## ‚úÖ HIGH –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - 100% –í–´–ü–û–õ–ù–ï–ù–û (6/6)

1. ‚úÖ **ERID & Affiliate Link Handling**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ERID (`tg-YYYYMMDD-XXXXXX`)
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è affiliate —Å—Å—ã–ª–æ–∫ —Å `urllib.parse`
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `correlation_id`

2. ‚úÖ **Shadow-Ban Detection —Å Auto-Pause**
   - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–∞–∑–º–µ—Ä—É HTML –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç–æ–≤–∞—Ä–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ –Ω–∞ 6-12 —á–∞—Å–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î

3. ‚úÖ **Product Key Deduplication**
   - SHA-1 hash (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - DB-level unique indexes
   - –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

4. ‚úÖ **Telegram Posting Service**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
   - –í—Å–µ OK

5. ‚úÖ **Playwright Fallback**
   - –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `services/playwright_parser_service.py`

6. ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ product_key**
   - –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `database.py`

---

## ‚úÖ MEDIUM –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –ß–ê–°–¢–ò–ß–ù–û –í–´–ü–û–õ–ù–ï–ù–û (4/9)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (4):

1. ‚úÖ **Structured Logging**
   - –°–æ–∑–¥–∞–Ω helper `services/structured_logging.py`
   - –î–æ–±–∞–≤–ª–µ–Ω `correlation_id` –≤ affiliate service
   - `correlation_id` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö

2. ‚úÖ **Unit Tests** (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
   - `tests/test_affiliate_improved.py` - —Ç–µ—Å—Ç—ã affiliate links
   - `tests/test_shadow_ban.py` - —Ç–µ—Å—Ç—ã shadow-ban detection
   - `tests/test_product_key.py` - —Ç–µ—Å—Ç—ã product_key generation

3. ‚úÖ **Backfill Script**
   - –°–æ–∑–¥–∞–Ω `scripts/backfill_product_keys.py`
   - –î–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π

4. ‚úÖ **Prometheus Metrics**
   - –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `services/prometheus_metrics_service.py`

### ‚è≥ –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ (5) - –ù–ï –ö–†–ò–¢–ò–ß–ù–û:

1. ‚è≥ **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ catalog URLs**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/catalog--naushniki/` –≤–º–µ—Å—Ç–æ free-text search
   - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –ø–æ score
   - **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. ‚è≥ **Health endpoint –¥–ª—è Docker/Kubernetes**
   - REST endpoint –¥–ª—è health checks
   - **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞

3. ‚è≥ **Integration tests**
   - Smoke test –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ pipeline
   - Shadow-ban simulation test
   - **–ü—Ä–∏—á–∏–Ω–∞:** Unit tests –ø–æ–∫—Ä—ã–≤–∞—é—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

4. ‚è≥ **Session reuse & Async best practices**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö `aiohttp.ClientSession`
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å "Unclosed client session" –æ—à–∏–±–∫–∏
   - **–ü—Ä–∏—á–∏–Ω–∞:** –¢—Ä–µ–±—É–µ—Ç runtime –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

5. ‚è≥ **DB batching**
   - Bulk inserts –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è batch –æ–ø–µ—Ä–∞—Ü–∏–π
   - **–ü—Ä–∏—á–∏–Ω–∞:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

---

## ‚è≥ LOW –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –ù–ï –í–´–ü–û–õ–ù–ï–ù–û (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ)

–≠—Ç–∏ –∑–∞–¥–∞—á–∏ —è–≤–ª—è—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:

1. ‚è≥ **Catalog selection and scoring**
   - –£–º–Ω—ã–π –≤—ã–±–æ—Ä –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. ‚è≥ **Input validation enhancements**
   - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. ‚è≥ **Dependency version pinning**
   - –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

4. ‚è≥ **Caching improvements**
   - –£–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í—ã–ø–æ–ª–Ω–µ–Ω–æ | –í—Å–µ–≥–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|-----------|-----------|-------|---------|
| **HIGH**  | 6         | 6     | **100%** ‚úÖ |
| **MEDIUM**| 4         | 9     | **44%** ‚è≥ |
| **LOW**   | 0         | 4     | **0%** ‚è≥ |

## üéØ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ (HIGH) –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ 100%!**

MEDIUM –∑–∞–¥–∞—á–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã - —ç—Ç–æ:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ endpoints
- Integration tests (unit tests —É–∂–µ –µ—Å—Ç—å)
- Runtime –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞)

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:

1. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è affiliate —Å—Å—ã–ª–æ–∫ —Å ERID
2. ‚úÖ Shadow-ban detection —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–∞—É–∑–æ–π
3. ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (SHA-1 product_key)
4. ‚úÖ DB-level unique indexes
5. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å correlation_id
6. ‚úÖ Unit tests –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
7. ‚úÖ Backfill —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!** –û—Å—Ç–∞–≤—à–∏–µ—Å—è MEDIUM –∏ LOW –∑–∞–¥–∞—á–∏:
- –ù–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
- –Ø–≤–ª—è—é—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
- –ú–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å runtime –º–µ—Ç—Ä–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "Unclosed client session" –≤ –ª–æ–≥–∞—Ö
3. –î–æ–±–∞–≤–∏—Ç—å integration tests –ø–æ –º–µ—Ä–µ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (DB batching, catalog scoring) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

