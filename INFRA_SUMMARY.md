# –°–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Docker Infrastructure
- ‚úÖ `docker-compose.yml` - Postgres 15 + Redis 7 + Bot
- ‚úÖ `Dockerfile` - –æ–±—Ä–∞–∑ –±–æ—Ç–∞ —Å Playwright
- ‚úÖ `.env.example` - —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `migrations/001_initial_schema.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:
  - `products` - –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
  - `metrics` - –º–µ—Ç—Ä–∏–∫–∏ affiliate —Å—Å—ã–ª–æ–∫
  - `post_performance` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–æ–≤
  - `category_performance` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  - `brand_performance` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º
  - `shadow_ban_log` - –ª–æ–≥–∏ shadow-ban –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞

### 3. –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### Playwright Parser Service
- ‚úÖ `services/playwright_parser_service.py`
- Fallback –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ headless browser
- –ü–∞—Ä—Å–∏—Ç `__NEXT_DATA__` –∏–∑ HTML
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ HTTP –ø–∞—Ä—Å–∏–Ω–≥ –≤–µ—Ä–Ω—É–ª < 5 —Ç–æ–≤–∞—Ä–æ–≤

#### Prometheus Metrics Service
- ‚úÖ `services/prometheus_metrics_service.py`
- –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ú–µ—Ç—Ä–∏–∫–∏: products_found, products_published, products_rejected, clicks
- HTTP endpoint: `http://localhost:9100/metrics`

#### Click Learning Service
- ‚úÖ `services/click_learning_service.py`
- –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–∫–∞—Ö
- –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/–±—Ä–µ–Ω–¥–∞–º/—Ü–µ–Ω–∞–º
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è: 70% —Ç–æ–ø-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, 20% –Ω–æ–≤—ã–µ, 10% —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

### 4. –°–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ `scripts/run_migrations.py` - –∑–∞–ø—É—Å–∫ SQL –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ `scripts/docker_setup.sh` - —Å–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `docs/QUICK_START.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- ‚úÖ `README_INFRA.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ `INFRA_SUMMARY.md` - —ç—Ç–∞ —Å–≤–æ–¥–∫–∞

### 6. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `prometheus_client>=0.18.0` –≤ requirements.txt

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Playwright Parser –≤ smart_search_service.py**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_playwright_parser()` –∫–æ–≥–¥–∞ HTTP –ø–∞—Ä—Å–∏–Ω–≥ –≤–µ—Ä–Ω—É–ª < 5 —Ç–æ–≤–∞—Ä–æ–≤

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Prometheus –º–µ—Ç—Ä–∏–∫**
   - –í—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `get_prometheus_service()` –≤ main_worker.py
   - –ó–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Click Learning**
   - –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –∫–ª–∏–∫–∏ —á–µ—Ä–µ–∑ `learn_from_clicks()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_top_categories()` –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤

5. **–ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å `python scripts/run_migrations.py` –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Postgres

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .env
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å BOT_TOKEN

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker
docker-compose up -d

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec bot python scripts/run_migrations.py

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f bot
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞: `http://localhost:9100/metrics`

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- `ymarket_products_found_total`
- `ymarket_products_published_total`
- `ymarket_products_rejected_total`
- `ymarket_clicks_total`

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. Playwright —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤: `playwright install chromium`
2. Prometheus –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `prometheus_client`
3. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –≤ `.env`
4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Postgres

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ main_worker.py
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫ –≤ –ë–î
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus + Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (rejections spike, publish worker down, shadow-ban)
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Playwright fallback –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–∞—Ö

